<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
{% load static_url %}
<link rel="stylesheet" type="text/css" href="{% static_url "main.css" %}" />

<title>{{ title }}</title>
<style>
div.expandable {
    display:block;
}
div.expandable_hidden {
    display:none;
}
</style>
<script>
function show(element_id)
{
    if(document.getElementById(element_id).style.display == 'none')
        document.getElementById(element_id).style.display = 'block';
    else
        document.getElementById(element_id).style.display = 'none';
}
</script>

</head>
<body>
<h1 class="title">
{% if report_type == 'minidumpReport' %}
Minidump-Report {{ object.crashid }} of {{ object.applicationName }} at {{ object.timestamp|date:"Y-m-d H:i:s" }}
{% elif report_type == 'minidump' %}
Download minidump {{ object.crashid }} of {{ object.applicationName }} at {{ object.timestamp|date:"Y-m-d H:i:s" }}
{% elif report_type == 'coredumpReport' %}
Coredump-Report {{ object.crashid }} of {{ object.applicationName }} at {{ object.timestamp|date:"Y-m-d H:i:s" }}
{% elif report_type == 'coredump' %}
Download coredump {{ object.crashid }} of {{ object.applicationName }} at {{ object.timestamp|date:"Y-m-d H:i:s" }}
{% else %}
Report {{ report_type }} {{ object.crashid }} of {{ object.applicationName }} at {{ object.timestamp|date:"Y-m-d H:i:s" }}
{% endif %}
</h1>

{% if flag == 'text' %}
<pre>{{ content }}</pre>
{% elif flag == 'html' %}


<table class='crash_info'>
<h2>Crash dump information</h2>
<tr><td>Id</td><td>{{ crash_info.uuid }}</td></tr>
<tr><td>Crash timestamp</td><td>{{ crash_info.crash_timestamp|date:"Y-m-d H:i:s" }}</td></tr>
<tr><td>Report timestamp</td><td>{{ crash_info.report_time|date:"Y-m-d H:i:s" }}</td></tr>
<tr><td>Application name</td>
<!--
<td><a href="{ % url "list_filter_app" crash_info.application %}">{{ crash_info.application }}</a></td>
-->
<td>{{ crash_info.application }}</td>
</tr>
<tr><td>Command line</td><td><pre>{% for e in crash_info.command_line %}&quot;{{ e }}&quot;{% endfor %}</pre></td></tr>
<tr><td>Report FQDN</td><td>{{ crash_info.report_fqdn }}</td></tr>
<tr><td>Report username</td><td>{{ crash_info.report_username }}</td></tr>
<tr><td>Symbol directories</td><td><ul>{% for e in crash_info.symbol_directories %}<li>{{e}}</li>{% endfor %}</ul></td></tr>
<tr><td>Image directories</td><td><ul>{% for e in crash_info.image_directories %}<li>{{e}}</li>{% endfor %}</ul></td></tr>
<tr><td>Environment</td><td>
<a href="javascript:;" onclick=show('environment')>Show</a>
<div class="expandable_hidden" id="environment">
<ul>
{% for k,v in crash_info.environment.items %}
<li>{{k}}&nbsp;=&nbsp;{{v}}</li>
{% endfor %}</ul>
</div>
</td></tr>
</table>

<a href="javascript:;" onclick=show('system_info')>System information</a>
<div class="expandable_hidden" id="system_info">
<table class='system_info'>
<tr><td>Platform type</td><td>{{ system_info.platform_type }}</td></tr>
<tr><td>CPU type</td><td>{{ system_info.cpu_type }}</td></tr>
<tr><td>CPU 64-bit</td><td>{{ system_info.cpu_64_bit }}</td></tr>
<tr><td>CPU name</td><td>{{ system_info.cpu_name }}</td></tr>
<tr><td>CPU level</td><td>0x{{ system_info.cpu_level|stringformat:"x" }}</td></tr>
<tr><td>CPU revision</td><td>0x{{ system_info.cpu_revision|stringformat:"x" }}</td></tr>
<tr><td>CPU vendor</td><td>{{ system_info.cpu_vendor }}</td></tr>
<tr><td>Number of CPUs</td><td>{{ system_info.number_of_cpus }}</td></tr>
<tr><td>OS version</td><td>{{ system_info.os_version }}</td></tr>
<tr><td>OS version info</td><td>{{ system_info.os_version_info }}</td></tr>
<tr><td>Distribution id</td><td>{{ system_info.distribution_id }}</td></tr>
<tr><td>Distribution release</td><td>{{ system_info.distribution_release }}</td></tr>
<tr><td>Distribution codename</td><td>{{ system_info.distribution_codename }}</td></tr>
<tr><td>Distribution description</td><td>{{ system_info.distribution_description }}</td></tr>
</table>
</div>

{% if exception %}
<h2>Exception</h2>
<table class='exception'>
<tr><td>Thread id</td><td>{{ exception.thread }}</td></tr>
<tr><td>Code</td><td>{{ exception.code }}</td></tr>
<tr><td>Name</td><td>{{ exception.name }}</td></tr>
<tr><td>Info</td><td>{{ exception.info }}</td></tr>
<tr><td>Address</td><td>0x{{ exception.address|stringformat:"x" }}</td></tr>
<tr><td>Flags</td><td>0x{{ exception.flags|stringformat:"x" }}</td></tr>
</table>
{% endif %}

{% if assertion %}
<h2>Assertion</h2>
<table class='assertion'>
<tr><td>Expression</td><td>{{ assertion.expression }}</td></tr>
<tr><td>Function</td><td>{{ assertion.function }}</td></tr>
<tr><td>Source</td><td>{{ assertion.source }}</td></tr>
<tr><td>Line</td><td>{{ assertion.line }}</td></tr>
</table>
{% endif %}

<h2>Modules</h2>
<table class='modules'>
<tr>
<th>Base</th>
<th>Size</th>
<th>Timestamp</th>
<th>Product version</th>
<th>File version</th>
<th>Flags</th>
<th>Name</th>
<th>Symbol file</th>
</tr>
{% for module in modules %}
<tr>
<td>0x{{ module.base|stringformat:"x" }}</td>
<td>{{ module.size|filesizeformat }} </td>
<td>{{ module.timestamp|date:"Y-m-d H:i:s" }}</td>
<td>{{ module.product_version }} </td>
<td>{{ module.file_version }}</td>
<td>{{ module.flags }}</td>
<td>{{ module.name }}</td>
<td>{{ module.symbol_file }} </td>
</tr>
{% endfor %}
</table>

<h2>Threads</h2>
<table class='threads'>
<tr>
<th>Id</th>
<th>Name</th>
<th>Memory</th>
<th>Start address</th>
<th>Create time</th>
<th>Exit time</th>
<th>Kernel time</th>
<th>User time</th>
</tr>
{% for thread in threads %}
<tr>
<td>0x{{ thread.id|stringformat:"x" }}{% if thread.exception %}*{% endif %}</td>
<td>{{ thread.name }} </td>
<td>0x{{ thread.memory|stringformat:"x" }}</td>
<td>0x{{ thread.start_addr|stringformat:"x" }}</td>
<td>{{ thread.create_time|date:"Y-m-d H:i:s" }}</td>
<td>{{ thread.exit_time|date:"Y-m-d H:i:s" }}</td>
<td>{{ thread.kernel_time|time:"H:i:s" }} </td>
<td>{{ thread.user_time|time:"H:i:s" }}</td>
</tr>
{% endfor %}
</table>

<h2>Stack dumps</h2>
{% for stackdump in stackdumps %}
<h3>Thread 0x{{ stackdump.threadid|stringformat:"x" }}{% if stackdump.exception %} with exception{% endif %}</h3>
<table class='callstack'>
<tr>
<th>Num</th>
<th>Addr</th>
<th>RetAddr</th>
<th>Param0</th>
<th>Param1</th>
<th>Param2</th>
<th>Param3</th>
<th>Module</th>
<th>Function</th>
<th>Source</th>
</tr>
{% for frame in stackdump.callstack %}
<tr>
<td>{{ frame.num }}</td>
<td>0x{{ frame.addr|stringformat:"x" }}</td>
<td>0x{{ frame.retaddr|stringformat:"x" }}</td>
<td>0x{{ frame.param0|stringformat:"x" }}</td>
<td>0x{{ frame.param1|stringformat:"x" }}</td>
<td>0x{{ frame.param2|stringformat:"x" }}</td>
<td>0x{{ frame.param3|stringformat:"x" }}</td>
<td>{{ frame.module }}</td>
<td>{{ frame.function }}</td>
<td>{{ frame.source }}</td>
</tr>
{% endfor %}
</table>

{% endfor %}

{% endif %}

<p><a href="{% url "crash_details" object.id %}">Back to {{ object.crashid }}</a>&nbsp;<a href="{% url "home" %}">Back to list</a></p>
</body>
</html>
